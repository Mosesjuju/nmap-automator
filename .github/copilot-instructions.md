# AI Agent Instructions for NMAP Automator

This project provides a sophisticated CLI wrapper for Nmap with extensive scan automation, scheduling capabilities, and vulnerability analysis integration. Here's what you need to know to work effectively with this codebase.

## Project Architecture

### Core Components
- `nmap_automator_new.py`: Main CLI interface and orchestration
- `vuln_analyzer.py`: Optional OpenAI-powered vulnerability analysis

### Key Features
1. Comprehensive Nmap integration
2. Scheduled scanning support
3. Multi-target handling with parallel execution
4. Vulnerability analysis with OpenAI integration
5. Structured output management

## Development Patterns

### CLI Argument Groups
Arguments are organized into logical groups in `main()`:
```python
tgroup = parser.add_argument_group('Target Selection')
hgroup = parser.add_argument_group('Host Discovery')
sgroup = parser.add_argument_group('Scan Techniques')
```

### Output Structure
- Results are organized by target and timestamp
- Both normal and XML outputs are generated by default
- Central logging with timestamp and verbosity control

### Worker Pattern
- Parallel scan execution using thread pool
- Queue-based task distribution
- Safe thread termination handling

### Scan Configuration
Scans are built up progressively through:
1. Core parameters (target, ports)
2. Technique flags (-sS, -sT, etc.)
3. Extra arguments (version detection, scripts)
4. Output options

## Common Tasks

### Adding New Scan Types
1. Add arguments to appropriate group in `main()`
2. Update `extra_parts` construction
3. Modify `build_nmap_command()` if needed

### Vulnerability Analysis Integration
- Check `VulnerabilityAnalyzer` class for OpenAI API usage
- CVE parsing and analysis patterns in `analyze_vulnerabilities()`

### Debug Approach
- Use `--dry-run` to verify command construction
- Enable `-v/-vv` for detailed scan progress
- Check scan_log.txt for execution history

## Development Guidelines

### Safety Checks
- Always include target validation
- Use `check_nmap_available()` before operations
- Implement rate limiting for scheduled scans

### Error Handling
- Graceful handling of missing dependencies
- Clear error messages for misconfiguration
- Proper cleanup on interruption

### XML Processing
- Use `xml.etree.ElementTree` for parsing
- Structure matches Nmap XML output format
- WebMap integration support